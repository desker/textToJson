!function(t,n){"function"==typeof define&&define.amd?define([],n):"object"==typeof exports?module.exports=n():t.TextToJson=n()}(this,function(){"use strict";function t(t){return"object"==typeof t}function n(t){return"string"==typeof t}function i(t){this.init(t)}function e(t,n){var e=new i(t);return e.tag("b",/\*\*([\S\s]+?)\*\*/g,"**"),e.tag("i",/\*([\S\s]+?)\*/g,"*"),e.tag("hash",/\#([\S][^.,]+)/g,"#"),n&&e.smiles(n),e.line(),e.lines}return i.prototype={init:function(t){this.lines=t.split("\n").map(function(t){return[t]})},tag:function(t,i,e){for(var s=t[0]+"|",u=this,o=0;o<this.lines.length;o++){var r=this.lines[o],l=[];r.map(function(r,h){if(!n(r))return void l.push(r);var a=r.replace(i,e+s+"$1"+e).split(e);a.map(function(n){return""!==n&&" "!==n?n.substr(0,2)===s?(n=n.substr(2),void l.push({tag:t,value:n})):void l.push(n):void 0}),u.lines[o]=l})}},smiles:function(t){for(var i=0;i<t.length;i++)for(var e=t[i],s=0;s<this.lines.length;s++){var u=this.lines[s],o=[];u.map(function(t){return n(t)?(t=t.split(e),void t.map(function(n,i){""!==n&&o.push(n),i!==t.length-1&&o.push({tag:"smile",value:e})})):void o.push(t)}),this.lines[s]=o}console.log(this.lines)},line:function(){var i=[],e=this;this.lines.map(function(s,u){var o=i[i.length-1];if(1===s.length&&n(s[0])&&(s=s[0]),"..."===s)return void i.push({tag:"hr"});if(s.length>0&&(">"===s[0]||s[0][0]&&">"===s[0][0]))return n(s)?s=s.substr(1):s[0]=s[0].substr(1),void(t(o)&&"blockquote"===o.tag?i[i.length-1].value.push(s):i.push({tag:"blockquote",value:[s]}));if(0===s.length){if(t(o)&&"br"===o.tag||u===e.lines.length-1)return;return void i.push({tag:"br"})}i.push(s)}),this.lines=i}},e});