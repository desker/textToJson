!function(t,n){"function"==typeof define&&define.amd?define([],n):"object"==typeof exports?module.exports=n():t.TextToJson=n()}(this,function(){"use strict";function t(t){return"object"==typeof t}function n(t){return"string"==typeof t}function i(t){this.init(t)}function e(t,n){var e=new i(t);return e.tag("b",/\*\*([\S\s]+?)\*\*/g,"**"),e.tag("i",/\*([\S\s]+?)\*/g,"*"),e.tag("hash",/\#([\S][^.,]+)/g,"#"),e.mentions(),n&&e.smiles(n),e.line(),e.lines}return i.prototype={init:function(t){this.lines=t.split("\n").map(function(t){return[t]})},tag:function(t,i,e){for(var s=t[0]+"|",u=this,r=0;r<this.lines.length;r++){var o=this.lines[r],h=[];o.map(function(o,l){if(!n(o))return void h.push(o);var a=o.replace(i,e+s+"$1"+e).split(e);a.map(function(n){return""!==n&&" "!==n?n.substr(0,2)===s?(n=n.substr(2),void h.push({tag:t,value:n})):void h.push(n):void 0}),u.lines[r]=h})}},smiles:function(t){for(var i=0;i<t.length;i++)for(var e=t[i],s=0;s<this.lines.length;s++){var u=this.lines[s],r=[];u.map(function(t){return n(t)?(t=t.split(e),void t.map(function(n,i){""!==n&&r.push(n),i!==t.length-1&&r.push({tag:"smile",value:e})})):void r.push(t)}),this.lines[s]=r}},mentions:function(){for(var t=/@id(g?)([\d]+)\(([\S\s]+?)\)/g,i=0;i<this.lines.length;i++){var e=this.lines[i],s=[];e.map(function(i,e){if(!n(i))return void s.push(i);for(var u,r=[],o=i;null!=(u=t.exec(i));)r.push(u);if(0===r.length)return void s.push(i);for(var h=0;h<r.length;h++){var l=o.split(r[h][0]);s.push(l[0]);var a={tag:"mention",value:r[h][3],id:r[h][2]};"g"===r[h][1]&&(a.isGroup=!0),s.push(a),o=l[1]}s.push(o)}),this.lines[i]=s}},line:function(){var i=[],e=this;this.lines.map(function(s,u){var r=i[i.length-1];if(1===s.length&&n(s[0])&&(s=s[0]),"..."===s)return void i.push({tag:"hr"});if(s.length>0&&(">"===s[0]||s[0][0]&&">"===s[0][0]))return n(s)?s=s.substr(1):s[0]=s[0].substr(1),void(t(r)&&"blockquote"===r.tag?i[i.length-1].value.push(s):i.push({tag:"blockquote",value:[s]}));if(0===s.length){if(t(r)&&"br"===r.tag||u===e.lines.length-1)return;return void i.push({tag:"br"})}i.push(s)}),this.lines=i}},e});